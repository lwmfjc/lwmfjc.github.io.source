---
title: 40-57
description: ''
categories:
  - 学习
tags:
  - 算法红皮书(第四版)
date: 2022-06-04 11:49:54
updated: 2022-06-04 11:49:54
---

## LambdaXxxWrapper

- LambdaQueryWrapper主要是为了防止字段名写错

  ```java
     @Test
      public void test11(){
  
          String username="abc";
          Integer ageBegin=null;
          Integer ageEnd=30;
          LambdaQueryWrapper<User> queryWrapper=new LambdaQueryWrapper<>();
          queryWrapper.like(StringUtils.isNotBlank(username),User::getUserName,username)
                  .ge(ageBegin!=null,User::getAge,ageBegin);
          userMapper.selectList(queryWrapper);
      }
  ```

  sql日志打印

  ```
  ==>  Preparing: SELECT uid AS id,name AS userName,age,email,is_deleted_ly FROM t_user WHERE is_deleted_ly=0 AND (name LIKE ?)
  ==> Parameters: %abc%(String)
  <==      Total: 0
  ```

- LambdaUpdateWrapper

  ```java
      @Test
      public void test12() {
  
          //(age>23且用户名包含a)  或 (邮箱为null)
          LambdaUpdateWrapper<User> updateWrapper = new LambdaUpdateWrapper<>();
          updateWrapper.like(User::getUserName, "a")
                  .and(userUpdateWrapper ->
                          userUpdateWrapper.gt(User::getAge, 23).or().isNotNull(User::getEmail));
          updateWrapper.set(User::getUserName, "小黑").set(User::getEmail, "abc@ly.com");
          userMapper.update(null, updateWrapper);
      }
  ```

  sql日志打印

  ```java
  ==>  Preparing: UPDATE t_user SET name=?,email=? WHERE is_deleted_ly=0 AND (name LIKE ? AND (age > ? OR email IS NOT NULL))
  ==> Parameters: 小黑(String), abc@ly.com(String), %a%(String), 23(Integer)
  <==    Updates: 0
  ```

  

## MyBatis分页

- 先使用配置类

  ```java
  
  @Configuration
  @MapperScan("com.ly.mybatisplus.mapper")
  public class MyBatisConfig {
      
      @Bean
      public MybatisPlusInterceptor mybatisPlusInterceptor(){
          MybatisPlusInterceptor mybatisPlusInterceptor=new MybatisPlusInterceptor();
          mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
          return mybatisPlusInterceptor;
      }
      
  }
  ```

- 使用

  ```java
      @Test
      public void testPage() {
          Page<User> page = new Page<>();
          page.setCurrent(2);//当前页页码
          page.setSize(3);//每页条数
          Page<User> userPage = userMapper.selectPage(page, null);
          System.out.println(userPage.getRecords() + "----\n"
                  + userPage.getPages() + "----\n"
                  + userPage.getTotal() + "---\n")
          ;
      }
  ```

  sql日志打印

  ```
  ==>  Preparing: SELECT uid AS id,name AS userName,age,email,is_deleted_ly FROM t_user WHERE is_deleted_ly=0 LIMIT ?,?
  ==> Parameters: 3(Long), 3(Long)
  <==    Columns: id, userName, age, email, is_deleted_ly
  <==        Row: 4, 被修改了, 21, test4@baomidou.com, 0
  <==        Row: 5, 被修改了, 24, email被修改了, 0
  <==        Row: 6, 张三5, 18, test5@baomidou.com, 0
  <==      Total: 3
  ```

  - 结果Page对象的数据

    ```
    [User(id=4, userName=被修改了, age=21, email=test4@baomidou.com, isDeletedLy=0), User(id=5, userName=被修改了, age=24, email=email被修改了, isDeletedLy=0), User(id=6, userName=张三5, age=18, email=test5@baomidou.com, isDeletedLy=0)]----
    3----
    8---
    ```

- 自定义分页功能

  - 首先，设置类型别名所在的包

    ```yml
    mybatis-plus: 
      type-aliases-package: com.ly.mybatisplus.pojo
    ```

  - 在Mapper类中编写接口方法

    ```java
    @Repository
    public interface UserMapper extends BaseMapper<User> { 
    
        /**
         * 通过年龄查询并分页
         * @param page mybatis-plus提供的，必须存在且在第一个位置
         * @param age
         * @return
         */
        Page<User> selectPageVO(Page<User> page,Integer age);
    }
    ```

    注意第一个参数

  - 在Mapper.xml中编写语句

    ```xml
        <select id="selectPageVO" resultType="User">
            select uid,name,email from t_user where age > #{age}
        </select>
    ```

  - 测试方法

    ```java
       @Test
        public void testPageCustom() {
            Page<User> page = new Page<>();
            page.setCurrent(3);//当前页页码
            page.setSize(5);//每页条数
            Page<User> userPage = userMapper.selectPageVO(page, 12);
            System.out.println(userPage.getRecords() + "----\n"
                    + userPage.getPages() + "----\n"
                    + userPage.getTotal() + "---\n")
            ;
        }
    ```

    sql日志输出

    ```
    ==>  Preparing: SELECT COUNT(*) AS total FROM t_user WHERE age > ?
    ==> Parameters: 12(Integer)
    <==    Columns: total
    <==        Row: 20
    <==      Total: 1
    //从第10行开始（不包括第10行），取5条记录
    ==>  Preparing: select uid,name,email from t_user where age > ? LIMIT ?,?
    ==> Parameters: 12(Integer), 10(Long), 5(Long)
    <==    Columns: uid, name, email
    <==        Row: 11, a, null
    <==        Row: 12, a, null
    <==        Row: 13, a, null
    <==        Row: 14, a, null
    <==        Row: 15, a, null
    <==      Total: 5
    Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@706fe5c6]
    [null, null, null, null, null]----
    4----
    20---
    
    
    ```


    注意上面那个sql，他会先查询条数，如果条数<=0，那么就不会执行下面的数据搜索了

## 悲观锁和乐观锁



## 模拟冲突

## 乐观锁插件

## 优化修改流程

## 通用枚举

## 代码生成器

## 模拟多数据源环境

## 安装MyBatisX插件

## MyBatis代码快速生成







