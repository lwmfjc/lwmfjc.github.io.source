---
title: 索引
description: 索引
categories:
  - 学习
tags:
  - 复习
  - 复习-javaGuide
  - 复习-javaGuide-database
date: 2023-01-10 22:09:25
updated: 2023-01-11 09:09:25
---

> 转载自https://github.com/Snailclimb/JavaGuide（添加小部分笔记）感谢作者!

# 索引介绍

- 索引是一种用于**快速查询**和**检索数据**的数据结构，其本质可以看成是一种**排序好**的数据结构

  > 索引的作用就相当于书的目录。打个比方: 我们在查字典的时候，如果没有目录，那我们就只能一页一页的去找我们需要查的那个字，速度很慢。如果有目录了，我们只需要先去目录里查找字的位置，然后直接翻到那一页就行了

- 索引底层数据结构存在很多种类型，常见的索引结构有：**B树**，**B+树**和**Hash**、**红黑树**。在MySQL中，无论是Innodb还是MyIsam，都使用了B+树作为索引结构

# 索引的优缺点

**优点：**

- 使用索引可以大大**加快** 数据的检索速度（大大**减少检索的数据量**）, 这也是创建索引的最主要的原因。
- 通过创建**唯一性索引**，可以保证数据库表中**每一行数据的唯一性**。

**缺点：**

- **创建索引**和**维护索引**需要**耗费许多**时间。当对表中的数据进行**增删改**的时候，如果数据有索引，那么**索引也需要动态的修改**，会**降低 SQL 执行效率**。
- 索引需要使用**物理文件存储**，也会**耗费一定空间**

**索引一定会提高查询性能吗**

- 多数情况下，**索引查询**都是比**全表扫描**要快的。但是如果数据库的**数据量不大**，那么使用**索引也不一定能够带来很大提升**

# 索引的底层数据结构

## Hash表

- 哈希表是键值对的集合，通过**键（key）**即可**快速取出对应的值（value）**，因此哈希表可以**快速检索数据（接近O(1))**

- 为何能够通过key快速取出value呢？原因在于**哈希算法（也叫散列算法）**。通过哈希算法，我们可以**快速找到key对应的index**，找到了index也就找到了对应的value

  ```java
  hash = hashfunc(key)
  index = hash % array_size
  ```

  注意，图中keys是**字符串**，**不是什么莫名其妙的人**
  ![image-20230111105843993](https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/image-20230111105843993.png)

- 哈希算法有个 **Hash 冲突** 问题，也就是说**多个不同的 key 最后得到的 index 相同**。通常情况下，我们常用的解决办法是 **链地址法**。链地址法就是**将哈希冲突数据存放在链表中**。就比如 JDK1.8 之前 `HashMap` 就是通过**链地址法来解决哈希冲突**的。不过，JDK1.8 以后`HashMap`**为了减少链表过长**的时候搜索时间过长引入了**红黑树**。

- 为了减**少 Hash 冲突**的发生，一个**好的哈希函数**应该**“均匀地”将数据分布**在整个可能的哈希值集合中  

- 由于**Hash索引**不支持**顺序**和**范围查询**，假如要对表中的数据进行**排序**或者**进行范围查询**，那**Hash索引**就不行了，并且，**每次IO**只能取一个

  > 例如：  ```SELECT * FROM tb1 WHERE id < 500 ; ```
  >
  > - 这种范围查询中，B+树 优势非常大 直接遍历比500小的叶子节点即可
  > - 如果使用Hash索引，由于**Hash索引**是根据hash算法来定位的，难不成把1 ~499 （小于500）的数据都进行一次hash计算来定位吗？这就是Hash最大的缺点

## B树& B+ 树



# 索引类型

## 主键索引（Primary Key）

## 二级索引（辅助索引）

# 聚簇索引与非聚簇索引

## 聚簇索引（聚集索引）

## 非聚簇索引（非聚集索引）

# 覆盖索引和联合索引

## 覆盖索引

## 联合索引

## 最左前缀匹配原则

# 索引下推

# 争取使用索引的一些建议

## 选择合适的字段创建索引

## 被频繁更新的字段应该慎重建索引

## 尽可能地考虑建立联合索引而不是单列索引