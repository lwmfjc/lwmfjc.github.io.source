---
title: 07B+数索引的使用
description: 07B+数索引的使用
tags:
  - MySQL是怎样运行的
categories:
  - 学习
date: 2023-04-24 14:32:22
updated: 2023-04-24 14:32:22
---

> 学习《MySQL是怎样运行的》，感谢作者！

# InnoDB存储引擎的B+树索引：结论

- **每个索引**对应一颗B+树。B+树有好多层，**最下边一层**是**叶子节点**，其余是**内节点**。所有**用户记录**都存在B+树的**叶子节点**，所有**目录项记录**都存在内节点
- InnoDB 存储引擎会**自动为主键建立聚簇索引**(如果**没有显式指定主键**或者**没有声明不允许存储NULL的UNIQUE 键**，它会自动添加主键) ， **聚簇索引**的**叶子节点**包含**完整的用户记录**
-  我们可以为感兴趣的列建立**二级索引**，二级索引的叶子节点包含的用户记录由**索引列**
  **和主键**组成。如果想通过二级索引查找完整的用户记录，需要执行**回表**操作， 也就是在通过二级索引**找到主键值之后**，再到**聚簇索引**中查找完整的用户记录
- B+ 树中的**每层节点**都按照**索引列的值从小到大的顺序排序**组成了**双向链表**，而且每个**页内的记录**(无论是**用户记录**还是**目录项记录**)都按照索引列的值从小到大的顺序形成了一个单向链表。如果是联合索引， 则**页面**和**记录** **先**按照索引列中前面的列的值排序：**如果该列的值相同**，**再按照索引列中后面的列的值排序**。比如， 我们对列c2 和c3建立了联合索引 **idx_c2_c3(c2， c3)**，那么该索引中的页面和记录就**先按照c2 列**的值进行排序；**如果c2 列的值相同**， **再按照c3** 列的值排序
- 通过索引查找记录时，是**从B+ 树的根节点开始一层一层向下搜索的**。由于每个页面(无论是**内节点页面**还是**叶子节点页面**〉中的记录都划分成了**若干个组**， 每个组中**索引列值最大的记录**在**页内的偏移量**会被当作**槽**依次存放在**页目录中**(当然， 规定Supremum 记录比任何用户记录都大) ，因此可以在**页目录中通过二分法**快速定位到**索引列等于某个值的记录**  

>  如果大家在阅读上述结论时哪怕有点疑惑， 那么下面的内容就不适合你，请回过头去反复阅读前面的章节

# B+树索引示意图的简化

```shell
#创建新表
mysql> CREATE TABLE single_table(
      id INT NOT NULL AUTO_INCREMENT,
      key1 VARCHAR(100),
      key2 INT,
      key3 VARCHAR(100),
      key_part1 VARCHAR(100),
      key_part2 VARCHAR(100),
      key_part3 VARCHAR(100),
      common_field VARCHAR(100),
      PRIMARY KEY (id),
      KEY idx_key1(key1),
      UNIQUE KEY uk_key2(key2),
      KEY idx_key3(key3),
      KEY idx_key_part(key_part1,key_part2,key_part3)
      ) Engine=InnoDB CHARSET = utf8;
```



# 索引的代价

# 应用B+树索引

# 回表的代价

# 更好地创建和使用索引

