---
title: MySQL高性能优化规范建议总结
description: MySQL高性能优化规范建议总结
categories:
  - 学习
tags:
  - 复习
  - 复习-javaGuide
  - 复习-javaGuide-database
date: 2023-01-20 11:36:34
updated: 2023-01-23 09:24:34
---

> 转载自https://github.com/Snailclimb/JavaGuide（添加小部分笔记）感谢作者!

# 数据库命名规范

- 所有**数据库对象**名称必须使用**小写字母**并用**下划线分割**
- 所有数据库对象名称**禁止使用 MySQL 保留关键字**（如果表名中包含关键字查询时，需要将其用单引号括起来）
- 数据库对象的命名要能做到**见名识意**，并且最好**不要超过 32 个**字符
- **临时库表**必须**以 `tmp_` 为前缀**并以日期为后缀，**备份表**必须**以 `bak_` 为前缀**并**以日期 (时间戳) 为后缀**
- 所有**存储相同数据的列名和列类型**必须一致（**一般作为关联列**，如果查询时关联列**类型不一致会自动进行数据类型隐式转换**，会**造成列上的索引失效**，导致查询效率降低）

# 数据库基本设计规范

## 所有表必须使用InnoDB存储引擎

- 没有特殊要求（即 InnoDB 无法满足的功能如：列存储，存储空间数据等）的情况下，所有表必须使用 InnoDB 存储引擎（MySQL5.5 之前默认使用 Myisam，5.6 以后默认的为 InnoDB）。
- InnoDB 支持**事务**，支持**行级锁**，更好的**恢复性**，**高并发**下性能更好

## 数据库和表的字符集统一使用UTF-8

**兼容性**更好，**统一字符集**可以避免由于字符集转换产生的**乱码**，不同的字符集进行比较前需要进行转换会造成**索引失效**，如果数据库中有**存储 emoji 表情**的需要，字符集需要采用 **utf8mb4** 字符集。

参考文章：

- [MySQL 字符集不一致导致索引失效的一个真实案例open in new window](https://blog.csdn.net/horses/article/details/107243447)
- [MySQL 字符集详解

## 所有表和字段都需要添加注释

使用 **comment 从句添加表**和**列的备注**，从一开始就进行数据字典的维护

## 尽量控制单表数据量的大小，建议控制在500万以内

- 500 万并不是 MySQL 数据库的限制，**过大会造成修改表结构**，**备份**，**恢复**都会有很大的问题。

- 可以用**历史数据归档（应用于日志数据）**，**分库分表（应用于业务数据）**等手段来控制数据量大小

## 谨慎使用MySQL分区表

- 分区表在**物理上表现为多个文件**，在**逻辑上表现为一个表**；

- 谨慎选择分区键，**跨分区查询效率可能更低**；
- 建议采用**物理分表的方式管理大数据**。

## 经常一起使用的列放到一个表中

避免更多的关联操作。

## 禁止在表中建立预留字段

- 预留字段的命名**很难做到见名识义**。
- 预留字段**无法确认存储的数据类型**，所以**无法选择合适的类型**。
- **对预留字段类型的修改，会对表进行锁定**

## 禁止在数据库中存储文本（比如图片）这类大的二进制数据

- 在数据库中存储文件会严重**影响数据库性能**，**消耗过多存储空间**。

- 文件（比如图片）这类大的二进制数据**通常存储于文件服务器**，数据库**只存储文件地址信息**。

## 不要被数据库范式所束缚

一般来说，设计关系数据库时需要满足第三范式，但为了满足第三范式，我们可能会拆分出多张表。而在**进行查询时需要对多张表进行关联查询**，有时为了**提高查询效率**，会**降低范式的要求**，在表中**保存一定的冗余**信息，也叫做**反范式**。但要注意反范式一定要适度。

## 禁止在线上做数据库压力测试

## 禁止从开发环境、测试环境，直接连接生产环境数据库

**安全隐患极大，要对生产环境抱有敬畏之心！**

# 数据库字段设计规范

## 优先选择符合存储需要的最小数据类型

![image-20230123123412164](https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/image-20230123123412164.png)

存储字节越小，**占用也就空间越小**，**性能也越好**。

**a.某些字符串可以转换成数字类型存储比如可以将 IP 地址转换成整型数据。**

数字是连续的，性能更好，占用空间也更小。

MySQL 提供了两个方法来**处理 ip 地址**

- `INET_ATON()` ： 把 ip 转为**无符号整型** (4-8 位)
- `INET_NTOA()` :把整型的 ip 转为地址

插入数据前，先用 `INET_ATON()` 把 ip 地址转为整型，显示数据时，使用 `INET_NTOA()` 把整型的 ip 地址转为地址显示即可。

**b.对于非负型的数据 (如自增 ID,整型 IP，年龄) 来说,要优先使用无符号整型来存储。**

无符号相对于有符号可以多出一倍的存储空间



```sql
SIGNED INT -2147483648~2147483647
UNSIGNED INT 0~4294967295
```

**c.小数值类型（比如年龄、状态表示如 0/1）优先使用 TINYINT 类型。**



## 避免使用TEXT、BLOB数据类型，最常见的TEXT类型可以存储64k的数据

## 避免使用ENUM类型

## 尽可能把所有的列定义为NOT NULL

## 使用TIMESTAMP(4个字节)或DATETIME类型（8个字节）存储时间

## 同财务相关的金额类数据必须使用decimal类型

## 单表不要包含过多字段

# 索引设计规范

## 限制每张表上的索引数量，建议单张表索引不超过5个

## 禁止使用全文索引

## 禁止给表中的每一列都建立单独的索引

## 每个InnoDB表必须有个主键

## 常见索引列建议

## 如何选择索引列的顺序

## 避免建立冗余索引和重复索引（增加了查询优化器生成执行计划的时间）

## 对于频繁的查询有优先考虑使用覆盖索引

## 索引SET规范



# 数据库SQL开发规范

## 优化对性能影响较大的SQL语句

## 充分利用表上已经存在的索引

## 禁止使用SELECT * 必须使用SELECT <字段列表> 查询

## 禁止使用不含字段列表的INSERT语句

## 建议使用预编译语句进行数据库操作

## 避免数据类型的隐式转换

## 避免使用子查询，可以把子查询优化为join操作

## 避免JOIN关联太多的表

## 减少同数据库的交互次数

## 对应同一列进行or判断时，使用in代替or

## 禁止使用order by rand() 进行随机排序

## WHERE从句中禁止对列进行函数转换和计算

## 在明显不会有重复值时使用UNION ALL 而不是 UNION

## 拆分复杂的大SQL为多个小SQL

## 程序连接不同的数据库使用不同的账号，禁止跨库查询



# 数据库操作行为规范

##  超 100 万行的批量写 (UPDATE,DELETE,INSERT) 操作,要分批多次进行操作

##  对于大表使用 pt-online-schema-change 修改表结构

## 禁止为程序使用的账号赋予 super 权限

 

## 对于程序连接数据库账号,遵循权限最小原则

 